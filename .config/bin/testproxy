#!/bin/bash

http_url="http://hotfile.com"
https_url="https://wiki.archlinux.org/index.php/Main_Page"

if ! [ -e ip.txt ]; then
	w3m -no-proxy -dump http://proxy.ipcn.org/proxylist.html > ip.txt
fi
{ rm ip.txt && cat|awk '{print $1}'|grep '[0-9a-zA-Z]:[0-9]'|sort|uniq > ip.txt;} < ip.txt

test_proxy(){
    t=`curl --proxy http://$i $https_url 2>/dev/null |grep "A guide through the whole process of installing"`
    if [ -n "$t" ];then
        echo $i >> https.txt
    else
        t=`curl --proxy http://$i $http_url 2>/dev/null |grep "Free one-click file hosting!"`
	if [ -n "$t" ];then
            echo $i >> http.txt
	fi
    fi
}

for i in `cat ip.txt`; do 
    test_proxy &
done

