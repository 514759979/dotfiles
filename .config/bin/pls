#!/bin/bash
cd ~/media/
while true; do
    lsfile=$(yad --list --center --no-headers --text=music_list --separator= --column=0 `ls -A` --width 300 --height 250);
    if [ -z "$lsfile" ]; then
        break
    fi
    cd $lsfile

    if [ "$lsfile" = "z_url" ]; then
        cat * > .tmplist
    else
        find . -type f -not -name ".*" > .tmplist
    fi

    file=$(yad --list --center --no-headers --text=music --separator= --column=0 `cat .tmplist` --width 800 --height 400);

    if [ -z "$file" ]; then
        cd ..
        continue
    fi

    file=`echo $file|sed 's/\//\\\\\//g'`
    n=$(sed -n /$file/= .tmplist)
    line=`cat .tmplist|wc -l`
    tail -n $((line-n+1)) .tmplist > /tmp/.tmplist
    head -n $((n-1)) .tmplist >> /tmp/.tmplist
    cat /tmp/.tmplist > .tmplist

    mplayer $flag -playlist .tmplist -quiet -loop 0
    cd ..
done

